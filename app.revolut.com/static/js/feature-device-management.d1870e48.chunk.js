(this["webpackJsonp@revolut/rwa-core-app"]=this["webpackJsonp@revolut/rwa-core-app"]||[]).push([[51],{4245:function(e,t,r){"use strict";r.r(t);r.d(t,"default",(function(){return Ue}));var n=r(666);var c=r(1490);var a=r(852);var i=r(3460);var o=r(7);var s=r(0);var v=r(73);var j=r(165);var u=r(281);var d;(function(e){e["DeviceManagement"]="/device-management";e["DeviceCard"]="/device-management/:deviceId"})(d||(d={}));var b=r(12);var l=r(3405);var O=r(164);var x=r(673);var p=r(25);var h=r(18);var C=r.n(h);var f=r(13);var m=r(27);var E=r(30);var D=r.n(E);var A=r(68);var P="sow/devices";var g=function(){var e=Object(m["a"])(C.a.mark((function e(t,r){var n;var c,a,i;return C.a.wrap((function e(o){while(1)switch(o.prev=o.next){case 0:c=(n={},Object(f["a"])(n,A["i"].UserId,t),Object(f["a"])(n,A["i"].DeviceId,r),n);o.next=3;return D.a.get(P,{headers:c});case 3:a=o.sent;i=a.data;return o.abrupt("return",i);case 6:case"end":return o.stop()}}),e)})));return function t(r,n){return e.apply(this,arguments)}}();var w;(function(e){e["Devices"]="Devices"})(w||(w={}));var M=function e(t,r){return Object(p["useQuery"])([w.Devices,r,t],(function(){return g(r,t)}),{enabled:Boolean(r)})};var I=function e(){var t=Object(x["b"])(),r=t.user;var n=Object(l["a"])(O["a"].DeviceId,""),c=Object(b["a"])(n,1),a=c[0];var i=M(a,null===r||void 0===r?void 0:r.id),o=i.data;return null!==o&&void 0!==o?o:[]};var k=r(66);var B=r.n(k);var T=r(1);var y=Object(s["createContext"])({popup:null,setPopup:B.a});var _=function e(t){var r=t.children;var n=Object(s["useState"])(null),c=Object(b["a"])(n,2),a=c[0],i=c[1];return Object(T["jsx"])(y.Provider,{value:{popup:a,setPopup:i},children:r})};var U=function e(){return Object(s["useContext"])(y)};var N;(function(e){e["DEVICE_MANAGEMENT"]="deviceManagement";e["DEVICE_CARD"]="deviceCard";e["LOGOUT_POPUP"]="logoutPopup";e["PASSCODE_POPUP"]="passcodePopup"})(N||(N={}));var S;(function(e){e["Browser"]="BROWSER";e["MobileApp"]="MOBILE_APP";e["MobileBrowser"]="MOBILE_BROWSER"})(S||(S={}));var V;(function(e){e["Android"]="ANDROID";e["Ios"]="IOS";e["Unknown"]="UNKNOWN"})(V||(V={}));var R;(function(e){e["Apple"]="Apple";e["Android"]="Android";e["Browser"]="Browser"})(R||(R={}));var G=function e(t){var r=t.type,n=t.browserModel,c=t.model;switch(r){case S.Browser:case S.MobileBrowser:return n;case S.MobileApp:return c;default:Object(j["a"])(new Error("Unsupported device type: ".concat(r)));return}};var L=r(1105);var W=function(){var e=Object(m["a"])(C.a.mark((function e(t){var r,n,c;return C.a.wrap((function e(a){while(1)switch(a.prev=a.next){case 0:r=t.userId,n=t.deviceId;c=Object(f["a"])({},A["i"].UserId,r);a.next=4;return D.a.post("".concat(P,"/").concat(n,"/signout"),{headers:c});case 4:case"end":return a.stop()}}),e)})));return function t(r){return e.apply(this,arguments)}}();var H=function e(){var t=Object(p["useQueryClient"])();return Object(p["useMutation"])(W,{onSuccess:function e(){t.invalidateQueries([w.Devices])}})};var z=r(3463);var Q=r(307);var F=r(261);var J=function e(t){var r=t.deviceTitle,n=t.onExit,c=t.onChangePasscode;var a=Object(u["a"])("".concat(N.DEVICE_MANAGEMENT,".components")),i=a.t;var o=Object(u["a"])("pages.Settings"),s=o.t;return Object(T["jsxs"])(Q["a"],{variant:"success-result",isOpen:true,onExit:n,children:[Object(T["jsx"])(Q["a"].Title,{children:Object(T["jsx"])(z["a"],{i18nKey:"".concat(N.PASSCODE_POPUP,".title"),t:i,values:{device:r}})}),Object(T["jsx"])(Q["a"].Description,{children:i("".concat(N.PASSCODE_POPUP,".description"))}),Object(T["jsxs"])(Q["a"].Actions,{children:[Object(T["jsx"])(F["a"],{onClick:c,children:s("securitySection.passcode.title")}),Object(T["jsx"])(F["a"],{variant:"secondary",onClick:n,children:i("".concat(N.PASSCODE_POPUP,".skip"))})]})]})};var K=function e(t){var r=Object(v["useHistory"])();var n=U(),c=n.setPopup;return Object(T["jsx"])(J,Object(o["a"])({onExit:function e(){return c(null)},onChangePasscode:function e(){return r.push(A["o"].ChangePasscode)}},t))};var q=r(665);var X=r(175);var Y=r(84);var Z=r(124);var $=r(380);var ee=function e(t){var r=t.onCancel,n=t.onLogout,c=t.isCurrent;var a=Object(u["a"])("".concat(N.DEVICE_MANAGEMENT,".components")),i=a.t;var o=Object(u["a"])($["a"].Common),s=o.t;return Object(T["jsxs"])(q["a"],{onExit:r,variant:"bottom-sheet",isOpen:true,children:[Object(T["jsxs"])(X["a"],{variant:"bottom-sheet",children:[Object(T["jsx"])(X["a"].Title,{children:i("".concat(N.LOGOUT_POPUP,".title"))})," "]}),Object(T["jsx"])(Y["j"],{variant:"caption",color:"grey-tone-50",children:i("".concat(N.LOGOUT_POPUP,c?".currentDeviceWarning":".otherDeviceWarning"))}),Object(T["jsx"])(q["a"].Actions,{children:Object(T["jsxs"])(Z["a"],{children:[Object(T["jsx"])(F["a"],{variant:"secondary",onClick:r,mr:"s-16",children:i("".concat(N.LOGOUT_POPUP,".cancel"))}),Object(T["jsx"])(F["a"],{variant:"primary",onClick:n,disabled:!n,children:s("logout")})]})})]})};var te=function e(t){var r=t.deviceTitle,n=t.isCurrent,c=t.deviceId;var a=U(),i=a.setPopup;var o=H(),j=o.mutate;var u=Object(v["useHistory"])();var b=Object(x["b"])(),l=b.user;var O=Object(s["useCallback"])((function(){return i(null)}),[i]);var p=Object(s["useCallback"])((function(){n?Object(L["b"])(L["a"].User):l&&j({userId:l.id,deviceId:c},{onSuccess:function e(){u.push(d.DeviceManagement);i(Object(T["jsx"])(K,{deviceTitle:r}))}})}),[i,r,u,j,c,n,l]);return Object(T["jsx"])(ee,{onCancel:O,onLogout:l&&p,isCurrent:n})};var re=r(59);var ne=r.n(re);var ce=r(401);var ae=r(6);var ie=r(297);var oe=r(55);var se=r(837);var ve=r(298);var je=r(1541);var ue=r(1498);var de=r(3474);var be=r(3091);var le=r(658);var Oe=r(176);var xe=function e(t){switch(t){case S.Browser:return Object(Oe["b"])("features/device_management/browser-device-avatar.svg");case S.MobileBrowser:case S.MobileApp:return Object(Oe["b"])("features/device_management/mobile-device-avatar.svg");default:Object(j["a"])(new Error("Unsupported device type: ".concat(t)));return}};var pe=function e(t){return Object(T["jsxs"])(T["Fragment"],{children:[Object(T["jsx"])(he,Object(o["a"])({},t)),Ce(t),Object(T["jsx"])(fe,Object(o["a"])({},t))]})};var he=function e(t){var r=t.type,n=t.browserModel,c=t.model,a=t.lastUsed,i=t.isCurrent,o=t.onLogout,s=t.onBack;var v=Object(u["a"])("".concat(N.DEVICE_MANAGEMENT,".components")),j=v.t;var d=Object(u["a"])($["a"].Common),b=d.t;return Object(T["jsxs"])(X["a"],{variant:"item",children:[Object(T["jsx"])(X["a"].BackButton,{onClick:s}),Object(T["jsx"])(X["a"].Title,{children:G({type:r,browserModel:n,model:c})}),Object(T["jsx"])(X["a"].Description,{children:i?j("common.thisDevice"):!ne()(a)&&Object(ae["bb"])(String(j("".concat(N.DEVICE_CARD,".lastActivity"))),De(a))}),Object(T["jsx"])(X["a"].Bar,{children:Object(T["jsx"])(F["a"],{variant:"secondary",size:"sm",useIcon:je["a"],onClick:o,children:b("logout")})}),Object(T["jsx"])(X["a"].Avatar,{children:Object(T["jsx"])(ie["a"],{size:56,image:xe(r),children:i&&Object(T["jsx"])(ie["a"].Badge,{useIcon:ue["a"]})})})]})};var Ce=function e(t){var r=t.address;var n=r&&Ee(r);var c=r&&me(r);if(n&&c)return Object(T["jsx"])(de["a"],{address:c,center:n});return null};var fe=function e(t){var r=t.createdAt,n=t.brand,c=t.osVersion,a=t.browserModel,i=t.address;var o=Object(u["a"])("".concat(N.DEVICE_MANAGEMENT,".components")),s=o.t;return Object(T["jsx"])(oe["a"],{mt:"s-16",children:Object(T["jsxs"])(se["a"],{children:[!ne()(r)&&Object(T["jsxs"])(ve["b"],{children:[Object(T["jsx"])(ve["b"].Title,{children:s("".concat(N.DEVICE_CARD,".loginDate"))}),Object(T["jsx"])(ve["b"].Content,{children:De(r)})]}),n&&n!==R.Browser&&Object(T["jsxs"])(ve["b"],{children:[Object(T["jsx"])(ve["b"].Title,{children:s("".concat(N.DEVICE_CARD,".brand"))}),Object(T["jsx"])(ve["b"].Content,{children:n})]}),c&&Object(T["jsxs"])(ve["b"],{children:[Object(T["jsx"])(ve["b"].Title,{children:s("".concat(N.DEVICE_CARD,".version"))}),Object(T["jsx"])(ve["b"].Content,{children:c})]}),a&&Object(T["jsxs"])(ve["b"],{children:[Object(T["jsx"])(ve["b"].Title,{children:s("".concat(N.DEVICE_CARD,".browser"))}),Object(T["jsx"])(ve["b"].Content,{children:a})]}),(null===i||void 0===i?void 0:i.ipAddress)&&Object(T["jsxs"])(ve["b"],{children:[Object(T["jsx"])(ve["b"].Title,{children:"IP"}),Object(T["jsx"])(ve["b"].Content,{children:i.ipAddress})]})]})})};var me=function e(t){var r=t.city,n=t.country;return[r,n].filter(Boolean).join(", ")};var Ee=function e(t){var r=t.lat,n=t.lon;if(!ne()(r)&&!ne()(n))return{latitude:r,longitude:n};return};var De=function e(t){var r=new Date(t);return Object(ae["bb"])(Object(be["a"])(r),Object(ce["a"])(r,le["a"].TransactionsBankTransferProgressTime))};var Ae=function e(){var t;var r=Object(v["useHistory"])();var n=I();var c=Object(v["useParams"])(),a=c.deviceId;var i=Object(u["a"])("".concat(N.DEVICE_MANAGEMENT,".components")),d=i.t;var b=n.find((function(e){return e.id===a}));if(!b){var l=new Error("There are no device with such id: ".concat(a));Object(j["a"])(l);throw l}var O=null!==(t=G({type:null===b||void 0===b?void 0:b.type,browserModel:null===b||void 0===b?void 0:b.browserModel,model:null===b||void 0===b?void 0:b.model}))&&void 0!==t?t:d("common.device");var x=U(),p=x.setPopup;var h=Object(s["useCallback"])((function(){return p(Object(T["jsx"])(te,{isCurrent:true===(null===b||void 0===b?void 0:b.isCurrent),deviceTitle:O,deviceId:a}))}),[p,O,a,b]);return Object(T["jsx"])(pe,Object(o["a"])(Object(o["a"])({},b),{},{onBack:r.goBack,onLogout:h}))};var Pe=function e(){return Object(T["jsx"])(v["Route"],{exact:true,path:d.DeviceCard,component:Ae})};var ge=r(241);var we;(function(e){e["DeviceItemCurrentBadge"]="device-item-current-badge"})(we||(we={}));var Me=function e(t){var r=t.id,n=t.type,c=t.browserModel,a=t.model,i=t.isCurrent,o=t.lastUsed,s=t.address,v=t.onClick;var j=Object(u["a"])("".concat(N.DEVICE_MANAGEMENT,".components")),d=j.t;return Object(T["jsxs"])(ge["a"],{use:"button",onClick:v,children:[Object(T["jsx"])(ge["a"].Avatar,{children:Object(T["jsx"])(ie["a"],{size:40,image:xe(n),children:i&&Object(T["jsx"])(ie["a"].Badge,{useIcon:ue["a"],"data-testid":we.DeviceItemCurrentBadge})})}),Object(T["jsxs"])(ge["a"].Content,{children:[Object(T["jsx"])(ge["a"].Title,{children:G({type:n,browserModel:c,model:a})}),Object(T["jsx"])(ge["a"].Description,{children:i?d("common.thisDevice"):Object(ae["b"])(!ne()(o)&&Object(be["a"])(new Date(o)),null===s||void 0===s?void 0:s.city)})]})]})};var Ie=r(827);var ke=function e(){return Object(T["jsxs"])(Ie["d"],{children:[Object(T["jsx"])(Ie["d"].Avatar,{}),Object(T["jsxs"])(Ie["d"].Content,{children:[Object(T["jsx"])(Ie["d"].Title,{}),Object(T["jsx"])(Ie["d"].Description,{})]})]})};var Be=function e(){return Object(T["jsxs"])(se["a"],{children:[Object(T["jsx"])(ke,{}),Object(T["jsx"])(ke,{}),Object(T["jsx"])(ke,{}),Object(T["jsx"])(ke,{}),Object(T["jsx"])(ke,{})]})};var Te=function e(t){var r=t.devices,n=t.onDeviceClick,c=t.onBack;var a=Object(u["a"])("".concat(N.DEVICE_MANAGEMENT,".components")),i=a.t;return Object(T["jsxs"])(T["Fragment"],{children:[Object(T["jsxs"])(X["a"],{variant:"item",children:[Object(T["jsx"])(X["a"].BackButton,{onClick:c}),Object(T["jsx"])(X["a"].Title,{children:i("common.device_plural")})]}),0===r.length?Object(T["jsx"])(Be,{}):Object(T["jsx"])(se["a"],{children:r.map((function(e){return Object(s["createElement"])(Me,Object(o["a"])(Object(o["a"])({},e),{},{key:e.id,onClick:function t(){return(null===e||void 0===e?void 0:e.id)&&n(e.id)}}))}))})]})};var ye=function e(){var t=Object(v["useHistory"])();var r=I();return Object(T["jsx"])(Te,{devices:r,onDeviceClick:function e(r){return t.push(Object(v["generatePath"])(d.DeviceCard,{deviceId:r}))},onBack:t.goBack})};var _e=function e(){return Object(T["jsx"])(v["Route"],{exact:true,path:d.DeviceManagement,component:ye})};var Ue=function e(){return Object(T["jsx"])(n["b"],{theme:c["a"],children:Object(T["jsx"])(_,{children:Object(T["jsx"])(Ne,{})})})};var Ne=function e(){var t=U(),r=t.popup;return Object(T["jsxs"])(a["a"],{children:[Object(T["jsx"])(a["a"].Menu,{children:Object(T["jsx"])(i["a"],{})}),Object(T["jsxs"])(a["a"].Main,{children:[Object(T["jsx"])(Pe,{}),Object(T["jsx"])(_e,{})]}),r]})}}}]);
//# sourceMappingURL=feature-device-management.d1870e48.chunk.js.map